客户原始需求：

根据 中国A股 上市公司年度财务报告中的董事、监事及高级管理人员的姓名的位置，在各自类别中生成排序（rank变量），形成三张独立表格。
几乎都是固定的。这个是政策规定必须披露这个表格。如果极少数情况可能没有表格可以用字段“任职情况”定位
要分别排名，例如：董事张三在所有董事中排第几位，而不是在所有董监高中的排名。
在pdf年报中定位，看年报中名字出现的顺序。定位就是图片两个位置
对的，先以表格为准，而且定位一定是，我发的两张图片的定位，不能是其他位置的**数据收集一定要准确。**
有很多细节需要注意，比如，字段搜索怎么准确定位。
表格串页怎么搜索完整。
而且，这个名字，比如这个2个字的名字 有的是有空格 有的是有tab间隔 
**带董事两个字的，除了董事会秘书都是董事，带监事两个字的都是监事，其他都是高级管理人员**

基于上一个技术出现的问题：
1.只要在表格里的都排序，不管是否离任
2.第一种表格匹配不上，一定要匹配第二种 文字段“任职情况”

---

# 设计草案：自动化文档信息提取智能体
搭建一个自动化文档信息提取流水线，用于批量识别数万份公司年报各自的董事、监事和高级管理人员，并按照在年报中名字出现的先后顺序排序。
由于输入的是PDF，格式不稳定（有可能是表格，也可能是文字），且边缘情况较多，所以只能依靠大模型进行核心分析。
又由于页数很长（单PDF可能上百页），直接交付大模型几乎肯定会出错，因此需要一个处理管线，首先进行PDF分块，并引入先验知识，编写处理管线分模块编排。

---

大致设计如下：
输入：PDF
处理流水线：

编号 功能 方案 技术组合 目标
--- 预处理 ---
1 目录提取 顺序逐页OCR，并判断 粗查 目录页
2 目录解析 目录页解析，判断目标范围 精查 董监高章节起止页码
3 处理阈截取 截取指定页数范围生成处理目标(董监高章节) 粗查 董监高节选PDF
--- 核心MVP ---
4 核心块提取 将节选PDF整体PP-StructureV3处理，生成markdown文本，然后交付大模型提取出核心块[1] 精查 董监高核心块
[可选] 核心块校验 交付大模型，结合先验知识，校验核心块的合理性
5 信息抽取 交付大模型，结合先验知识，**依次抽取董事、监事、高管排序**[2][3] 分析 董监高排序表格（自然语言结构）
[可选] 结果校验 交付大模型，结合先验知识，校验结果的合理性
6 结构化输出 按照客户要求生成期望的格式整理和输出 schema 结构化数据
[可选] 并行投票 多模型并行处理，投票选出最优结果，提高准确率。debug阶段出现分歧需要重点关注。
--- 后处理 ---
7 schema转换 将结构化数据转换为客户需要的格式（如Excel、CSV等） schema 客户期望格式文件

[1] 之所以需要一步核心块提取，是为了缩小真正的分析范围，避免上下文过长导致性能下降和幻觉
同时，这一步的prompt需要模型对核心块（表格或文本）跨页的情况进行整合。
核心块即客户需求中的董监高表格或“任职情况”字段所在位置，必须保证不要选错了块。

[2] 这一步必须结合先验知识（客户需求中的细节）**注意细节**
并且需要分三次交付大模型，分别抽取董事、监事和高管的排序，以最大化避免混淆。
记得prompt中强调排序是基于名字在年报中出现的先后顺序，而不是其他标准。
此外，还需要在结果中添加备注列，标记缺失数据的情况。

[3] 对于这类任务，最不缺的就是边缘情况。不能让模型静默地给出有点不确定的答案（即使结果碰巧是正确的）。
应该在信息抽取阶段增加一轮继续对话，反问模型的确信程度（多类别）和疑虑点（API支持混用chat和schema，所以很方便），并返回保存
这就是应该和客户沟通的疑问点。


模型选型：
粗查：OCR+gpt4o
精查：PP-StructureV3+gpt4o
分析： gpt4o（或者更强模型）
schema： gpt4o